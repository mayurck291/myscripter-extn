// Generated by CoffeeScript 1.3.3
(function() {
  var BaazarController, MonkeyWrench,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  MonkeyWrench = angular.module('MonkeyWrench');

  BaazarController = (function() {

    BaazarController.$inject = ['$scope', '$routeParams', '$timeout', '$route', 'Baazar', 'recipes', 'GPauth'];

    function BaazarController(scope, routeParams, timeout, route, Baazar, recipes, gp) {
      var reload,
        _this = this;
      this.scope = scope;
      this.routeParams = routeParams;
      this.timeout = timeout;
      this.route = route;
      this.Baazar = Baazar;
      this.recipes = recipes;
      this.gp = gp;
      this.decRating = __bind(this.decRating, this);

      this.incRating = __bind(this.incRating, this);

      this.getUserInfo = __bind(this.getUserInfo, this);

      /* fucking masonary sucks
      */

      reload = localStorage.getItem('reload');
      console.log("reload is of type", typeof reload);
      if ((reload != null) && reload === "true") {
        console.log("will reload");
        localStorage.setItem('reload', false);
        window.location.reload();
      }
      /* fucking masonary sucks
      */

      this.scope.recipes = recipes;
      this.gp.load().then(function() {
        return _this.getUserInfo();
      }, function() {
        _this.scope.user = null;
        return _this.scope.signedIn = false;
      });
      this.scope.getStars = this.getStars;
      this.scope.getRemStars = this.getRemStars;
      this.scope.incRating = this.incRating;
      this.scope.decRating = this.decRating;
      this.timeout(function() {
        return _this.scope.$apply(function() {
          var allTabs, gg, tab, tabs, _i, _len;
          allTabs = document.getElementsByClassName('tabs');
          console.log(allTabs);
          for (_i = 0, _len = allTabs.length; _i < _len; _i++) {
            tabs = allTabs[_i];
            tab = new CBPFWTabs(tabs);
          }
          localStorage.setItem('reload', true);
          return gg = new CBPGridGallery(document.getElementById('grid-gallery'));
        });
      }, 200);
    }

    BaazarController.prototype.getStars = function(range) {
      var _i, _results;
      return (function() {
        _results = [];
        for (var _i = 1; 1 <= range ? _i <= range : _i >= range; 1 <= range ? _i++ : _i--){ _results.push(_i); }
        return _results;
      }).apply(this);
    };

    BaazarController.prototype.getRemStars = function(range) {
      var _i, _results;
      if (range === void 0) {
        range = 1;
      } else {
        range += 1;
      }
      return (function() {
        _results = [];
        for (var _i = range; range <= 10 ? _i <= 10 : _i >= 10; range <= 10 ? _i++ : _i--){ _results.push(_i); }
        return _results;
      }).apply(this);
    };

    BaazarController.prototype.getUserInfo = function() {
      var _this = this;
      return this.gp.getUserInfo().then(function(user) {
        _this.scope.user = user;
        return _this.scope.signedIn = true;
      }, function() {
        return _this.gp.signOut();
      });
    };

    BaazarController.prototype.incRating = function() {
      if (!(this.scope.fm != null)) {
        this.scop.fm = {};
      }
      if (this.scope.fm.rating >= 5) {

      } else {
        return this.scope.fm.rating -= 1;
      }
    };

    BaazarController.prototype.decRating = function() {
      if (!(this.scope.fm != null)) {
        this.scop.fm = {};
      }
      if (this.scope.fm.rating >= 5) {

      } else {
        return this.scope.fm.rating -= 1;
      }
    };

    return BaazarController;

  })();

  MonkeyWrench.controller('BaazarController', BaazarController);

}).call(this);
