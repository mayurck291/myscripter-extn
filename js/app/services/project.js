// Generated by CoffeeScript 1.3.3
(function() {
  var MonkeyWrench, Project;

  Project = (function() {

    function Project(Alert) {
      this.Alert = Alert;
    }

    Project.prototype["new"] = function() {
      var template;
      return template = {
        name: null,
        url: null,
        external: {
          js: [],
          css: []
        },
        js: null,
        css: null,
        enabled: true,
        autoApply: false,
        forked: false
      };
    };

    Project.prototype.isEmpty = function(value) {
      return [null, void 0, ""].indexOf(value) > -1;
    };

    Project.prototype.nextSequence = function() {
      var seq;
      seq = $.jStorage.get('sequence');
      if (seq != null) {
        $.jStorage.set('sequence', seq + 1);
        return seq;
      } else {
        $.jStorage.set('sequence', 2);
        return 1;
      }
    };

    Project.prototype.getIndices = function() {
      var indexes;
      indexes = $.jStorage.get('prjmyindexes_9');
      if (indexes != null) {
        return indexes;
      } else {
        return {};
      }
    };

    Project.prototype.saveIndices = function(indexes) {
      return $.jStorage.set('prjmyindexes_9', indexes);
    };

    Project.prototype.saveProject = function(id, project) {
      $.jStorage.set(id, project);
      return this.Alert.success("Hurrah.!! Project saved successfully");
    };

    Project.prototype.save = function(project, old_url) {
      var all_indexes, cur_url;
      if (this.isEmpty(project.id)) {
        project.id = this.nextSequence();
      }
      console.log("saving project", project);
      this.saveProject(project.id, project);
      all_indexes = this.getIndices();
      console.log("all indices", all_indexes);
      cur_url = project.url;
      console.log("is empty index for " + cur_url);
      if (this.isEmpty(all_indexes[cur_url])) {
        all_indexes[cur_url] = [];
      }
      console.log("empty old url to " + cur_url);
      if (this.isEmpty(old_url)) {
        old_url = cur_url;
      }
      console.log("check index of " + project.id + " in " + cur_url + " index " + all_indexes[cur_url]);
      if (all_indexes[cur_url].indexOf(project.id) === -1) {
        all_indexes[cur_url].push(project.id);
      }
      console.log("after update " + project.id + " in " + cur_url + " index " + all_indexes[cur_url]);
      if (cur_url !== old_url && all_indexes[old_url] && all_indexes[old_url].indexOf(project.id) > -1) {
        all_indexes[old_url].splice(all_indexes[old_url].indexOf(project.id), 1);
      }
      console.log("if edition remove old entry from indices " + project.id + " in old url " + old_url + " index " + all_indexes[old_url]);
      this.saveIndices(all_indexes);
    };

    Project.prototype.delete_project = function(project) {
      var all_indexes;
      all_indexes = getIndices();
      localStorage.removeItem(project.id);
      all_indexes[project.url].splice(all_indexes[project.url].indexOf($scope.cur_project.id), 1);
      saveIndices(all_indexes);
    };

    Project.prototype.get = function(id) {
      return $.jStorage.get(id);
    };

    Project.prototype.getAll = function() {
      var projects;
      projects = $.jStorage.get('prjmyindexes_9');
      if (projects !== null && projects !== void 0) {
        return projects;
      } else {
        return {};
      }
    };

    return Project;

  })();

  MonkeyWrench = angular.module('MonkeyWrench');

  MonkeyWrench.service('Project', ['Alert', Project]);

}).call(this);
