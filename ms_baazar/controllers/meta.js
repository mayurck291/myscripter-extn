// Generated by CoffeeScript 1.3.3
(function() {
  var Meta, Recipe, logger;

  Meta = require('../models/meta');

  Recipe = require('../models/recipe');

  logger = require('../utils/logger');

  exports.favourite = function(request, response) {
    var params, query, update, user, _id;
    params = request.body;
    _id = params._id;
    user = params.user;
    logger.info("" + user + " Favorited recipe " + _id);
    query = {
      _id: _id
    };
    update = {
      "$addToSet": {
        favs: user
      }
    };
    return Meta.update(query, update, function(error, noOfDocsUpdated) {
      return console.log(user, " Favorited recipe ", _id);
    });
  };

  exports.get = function(request, response) {
    var userFilter;
    userFilter = '_id name img';
    return Meta.find({}).populate('_id', '-ingredients').populate('users', userFilter).populate('favs', userFilter).populate('karma.user', userFilter).exec(function(error, recipes) {
      return response.json(recipes, 200);
    });
  };

}).call(this);
